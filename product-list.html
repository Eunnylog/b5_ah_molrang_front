<!-- product-list.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product List</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        .product-list-container {
            max-width: 800px;
            margin: 0 auto;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .product-item {
            background-color: #f5f5f5;
            padding: 20px;
            margin-bottom: 20px;
        }

        h3 {
            margin: 0;
            font-size: 18px;
        }

        p {
            margin: 10px 0;
            font-size: 14px;
        }

        button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="product-list-container">
        <h2>상품 목록</h2>
        <div class="product-list"></div>
    </div>
    <div class="product-create-container">
        <h2>상품 등록</h2>
        <form id="product-form" onsubmit="return false;">
            <div class="form-group">
                <label for="product-name">상품명</label>
                <input type="text" id="product-name" placeholder="상품명을 입력하세요">
            </div>
            <div class="form-group">
                <label for="product-price">가격</label>
                <input type="text" id="product-price" placeholder="가격을 입력하세요">
            </div>
            <div class="form-group">
                <label for="product-description">상품 설명</label>
                <textarea id="product-description" placeholder="상품 설명을 입력하세요"></textarea>
            </div>
            <div class="form-group">
                <label for="product-inventory">재고 수량</label>
                <input type="number" id="product-inventory" placeholder="재고 수량을 입력하세요">
            </div>
            <div class="form-group">
                <label for="product-image">이미지 업로드</label>
                <input type="file" id="product-image" accept="image/*">
            </div>
            <div class="form-group">
                <button type="submit" onclick="createProduct()">상품 등록</button>
            </div>
        </form>
    </div>
    <!-- Inside the <div class="product-list-container"> element -->
    <button onclick="navigateToCart()">장바구니로 이동</button>



    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        // API 호출을 위한 기본 URL 설정
        const baseURL = 'http://127.0.0.1:8000/';

        // 토큰을 로컬 스토리지에서 가져옵니다.
        const token = localStorage.getItem('token');

        // Axios 인스턴스 생성
        const api = axios.create({
            baseURL: baseURL,
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        // 상품 목록을 가져와서 화면에 표시하는 함수
        async function getProductList() {
            try {
                // 상품 목록 API 호출
                const response = await api.get('products/');
                const productList = response.data;

                // 상품 목록을 화면에 표시
                const productContainer = document.querySelector('.product-list');
                productList.forEach(product => {
                    console.log(productList)
                    const productItem = document.createElement('div');
                    const imageSrc = `${baseURL}${product.image}`;
                    // const imageSrc = `media/${product.image}`;
                    // const imageSrc = `http://127.0.0.1:5500/media/${product.image}`;
                    // const imageSrc = `http://127.0.0.1:5500${product.image}`;
                    // const imageSrc = baseURL + product.image;
                    // const imageSrc = `${window.location.origin}${product.image}`;
                    console.log(productItem)
                    productItem.classList.add('product-item');
                    productItem.innerHTML = `
                        <h3>${product.product}</h3>
                        <p>${product.price}원</p>
                        <p>${product.inventory_status}</p>
                        <p>${product.content}</p>
                        <p>작성자: ${product.writer}</p>
                        <img src="${imageSrc}" alt="${product.product}" width="200">

                        <button onclick="addToCart(${product.id})">장바구니에 담기</button>
                    `;
                    productContainer.appendChild(productItem);
                });
            } catch (error) {
                console.error('상품 목록을 가져오는데 실패했습니다:', error);
            }
        }

        // 상품을 등록하는 함수
        async function createProduct() {
            const productName = document.getElementById('product-name').value;
            const productPrice = document.getElementById('product-price').value;
            const productDescription = document.getElementById('product-description').value;
            const productInventory = document.getElementById('product-inventory').value; // 재고 수량 추가
            const productImage = document.getElementById('product-image').value;

            // FormData 객체를 생성하고 필드를 추가합니다
            const formData = new FormData();
            formData.append('product', productName);
            formData.append('price', productPrice);
            formData.append('content', productDescription);
            formData.append('total_quantity', productInventory);
            formData.append('image', document.getElementById('product-image').files[0]);

            try {
                // 상품 등록 API 호출
                const response = await api.post('products/', formData, {
                    headers: {
                        'Content-Type': 'multipart/form-data'
                    }
                });
                console.log('상품을 등록했습니다:', response.data);

                // 상품 등록 후 페이지 새로고침
                location.reload();
            } catch (error) {
                console.error('상품 등록에 실패했습니다:', error);
            }
        }

        // 장바구니에 상품을 추가하는 함수
        async function addToCart(productname) {
            const productInventory = document.getElementById('product-inventory').value; // 재고 수량 추가
            try {
                // 장바구니에 상품 추가 API 호출
                const response = await api.post('carts/', {
                    product: productname,
                    quantity: 1
                });
                console.log('장바구니에 상품을 추가했습니다:', response.data);
                alert('장바구니에 상품을 추가했습니다.'); // Optional: Show a success message
            } catch (error) {
                console.error('장바구니에 상품을 추가하는데 실패했습니다:', error);
                alert('장바구니에 상품을 추가하는데 실패했습니다.'); // Optional: Show an error message
            }
        }

        // 장바구니로 이동하는 함수
        function navigateToCart() {
            window.location.href = 'carts.html'; // Replace 'cart.html' with the actual URL of your shopping cart page
        }


        // 상품 목록을 가져와서 화면에 표시
        getProductList();
    </script>
</body>

</html>