<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>장바구니</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        .cart-container {
            max-width: 800px;
            margin: 0 auto;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .cart-item {
            background-color: #f5f5f5;
            padding: 20px;
            margin-bottom: 20px;
        }

        h3 {
            margin: 0;
            font-size: 18px;
        }

        p {
            margin: 10px 0;
            font-size: 14px;
        }

        button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="cart-container">
        <h2>장바구니</h2>
        <div class="cart-items">
            <!-- 장바구니 아이템들이 여기에 동적으로 추가될 것입니다 -->
            <meta charset="utf-8">
            <meta http-equiv="x-ua-compatible" content="ie=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <link rel="stylesheet" href="../static/css/carts.css">
            <title>아몰약! - 장바구니</title>
            </head>

            <body>
                <header id="site-header">
                    <div class="container">
                        <h1>AH MOLYAK <span>[</span> <em><a href="https://github.com/banghyunjae" target="_blank">계속
                                    거래하기</a></em>
                            <span class="last-span is-open">]</span>
                        </h1>
                        <div>
                            <div id="user-info">
                                <span id="user-id">user@user.com</span>
                            </div>
                            <div class="container">
                                <div class="btn-logout">
                                    <span>Logout</span>
                                    <div class="dot"></div>
                                </div>
                            </div>
                        </div>
                    </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script>
            // API 호출을 위한 기본 URL 설정
            const baseURL = 'http://127.0.0.1:8000/';

            // 토큰을 로컬 스토리지에서 가져옵니다.
            const token = localStorage.getItem('token');

            // Axios 인스턴스 생성
            const api = axios.create({
                baseURL: baseURL,
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            // 장바구니 목록을 가져와서 화면에 표시하는 함수
            async function getCartItems() {
                try {
                    // 장바구니 목록 API 호출
                    const response = await api.get('carts/');
                    const cartItems = response.data;

                    // 장바구니 목록을 화면에 표시
                    const cartContainer = document.querySelector('.cart-items');
                    console.log(cartContainer)
                    cartContainer.innerHTML = ''; // 기존 내용 초기화

                    cartItems.forEach(cartItem => {
                        console.log(cartItem)
                        const cartItemElement = document.createElement('div');
                        cartItemElement.classList.add('cart-item');

                        // 장바구니 아이템의 정보를 표시
                        const imageSrc = `${window.location.origin}${cartItem.image}`;


                        cartItemElement.innerHTML = `
                        <h3>${cartItem.product.product}</h3>
                        <p>${cartItem.product.price}원</p>
                        <p>${cartItem.product.inventory_status}</p>
                        <p>${cartItem.product.content}</p>
                        <p>작성자: ${cartItem.product.writer}</p>
                        <img src="${imageSrc}" alt="${cartItem.product.product}" width="200">
                    `;


                        cartContainer.appendChild(cartItemElement);
                    });
                } catch (error) {
                    console.error('장바구니 목록을 가져오는데 실패했습니다:', error);
                }
            }

            // 페이지 로드 시 장바구니 목록을 가져옵니다.
            window.addEventListener('load', getCartItems);
        </script>
</body>

</html>